'use client'; \n\nimport { useRef, useMemo } from 'react'; \nimport { useVirtualizer } from '@tanstack/react-virtual'; \nimport { Trash2 } from 'lucide-react'; \nimport { useBudgetStore } from '@/store/budgetStore'; \nimport { format } from 'date-fns'; \n\nexport function TransactionList() { \n    // Selective subscriptions - only re-renders when necessary\n    const deleteTransaction = useBudgetStore(state => state.deleteTransaction);\n    const getFilteredTransactions = useBudgetStore(state => state.getFilteredTransactions);\n    const transactions = useMemo(() => getFilteredTransactions(), [getFilteredTransactions]);\n\n    const parentRef = useRef<HTMLDivElement>(null);\n\n    // Virtual list setup - only renders visible rows\n    const rowVirtualizer = useVirtualizer({\n        count: transactions.length,\n        getScrollElement: () => parentRef.current,\n        estimateSize: () => 60, // Estimated row height in pixels\n        overscan: 5, // Render 5 extra rows above/below visible area\n    });\n\n    const formatCurrency = (amount: number) => {\n        return new Intl.NumberFormat('en-US', {\n            style: 'currency',\n            currency: 'USD',\n        }).format(amount);\n    };\n\n    const formatDate = (dateString: string) => {\n        try {\n            return format(new Date(dateString), 'MMM dd, yyyy');\n        } catch {\n            return dateString;\n        }\n    };\n\n    const handleDelete = (id: string) => {\n        if (confirm('Are you sure you want to delete this transaction?')) {\n            deleteTransaction(id);\n        }\n    };\n\n    if (transactions.length === 0) {\n        return (\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n                <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\n                    Transaction History\n                </h2>\n                <p className=\"text-center text-gray-500 dark:text-gray-400 py-8\">\n                    No transactions found. Add your first transaction to get started!\n                </p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                    Transaction History ({transactions.length})\n                </h2>\n                {transactions.length > 50 && (\n                    <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                        âš¡ Virtualized (rendering {Math.min(transactions.length, 15)} visible rows)\n                    </span>\n                )}\n            </div>\n\n            {/* Table Header */}\n            <div className=\"overflow-hidden border-b border-gray-200 dark:border-gray-700\">\n                <table className=\"w-full\">\n                    <thead>\n                        <tr className=\"border-b border-gray-200 dark:border-gray-700\">\n                            <th className=\"text-left py-3 px-2 text-sm font-semibold text-gray-700 dark:text-gray-300\">\n                                Date\n                            </th>\n                            <th className=\"text-left py-3 px-2 text-sm font-semibold text-gray-700 dark:text-gray-300\">\n                                Type\n                            </th>\n                            <th className=\"text-left py-3 px-2 text-sm font-semibold text-gray-700 dark:text-gray-300\">\n                                Category\n                            </th>\n                            <th className=\"text-left py-3 px-2 text-sm font-semibold text-gray-700 dark:text-gray-300\">\n                                Description\n                            </th>\n                            <th className=\"text-right py-3 px-2 text-sm font-semibold text-gray-700 dark:text-gray-300\">\n                                Amount\n                            </th>\n                            <th className=\"text-center py-3 px-2 text-sm font-semibold text-gray-700 dark:text-gray-300\">\n                                Action\n                            </th>\n                        </tr>\n                    </thead>\n                </table>\n            </div>\n\n            {/* Virtualized Table Body */}\n            <div\n                ref={parentRef}\n                className=\"overflow-auto\"\n                style={{ height: `${Math.min(600, transactions.length * 60)}px` }}\n            >\n                <div\n                    style={{\n                        height: `${rowVirtualizer.getTotalSize()}px`,\n                        width: '100%',\n                        position: 'relative',\n                    }}\n                >\n                    {rowVirtualizer.getVirtualItems().map((virtualRow) => {\n                        const transaction = transactions[virtualRow.index];\n                        return (\n                            <div\n                                key={transaction.id}\n                                style={{\n                                    position: 'absolute',\n                                    top: 0,\n                                    left: 0,\n                                    width: '100%',\n                                    height: `${virtualRow.size}px`,\n                                    transform: `translateY(${virtualRow.start}px)`,\n                                }}\n                            >\n                                <table className=\"w-full\">\n                                    <tbody>\n                                        <tr className=\"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\">\n                                            <td className=\"py-3 px-2 text-sm text-gray-900 dark:text-gray-100\" style={{ width: '15%' }}>\n                                                {formatDate(transaction.date)}\n                                            </td>\n                                            <td className=\"py-3 px-2\" style={{ width: '12%' }}>\n                                                <span\n                                                    className={`inline-block px-2 py-1 rounded-full text-xs font-medium ${\n                                                        transaction.type === 'income'\n                                                            ? 'bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300'\n                                                            : 'bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-300'\n                                                    }`}\n                                                >\n                                                    {transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)}\n                                                </span>\n                                            </td>\n                                            <td className=\"py-3 px-2 text-sm text-gray-700 dark:text-gray-300\" style={{ width: '15%' }}>\n                                                {transaction.category}\n                                            </td>\n                                            <td className=\"py-3 px-2 text-sm text-gray-700 dark:text-gray-300\" style={{ width: '30%' }}>\n                                                {transaction.description || '-'}\n                                            </td>\n                                            <td\n                                                className={`py-3 px-2 text-sm text-right font-semibold ${\n                                                    transaction.type === 'income'\n                                                        ? 'text-green-600 dark:text-green-400'\n                                                        : 'text-red-600 dark:text-red-400'\n                                                }`}\n                                                style={{ width: '18%' }}\n                                            >\n                                                {transaction.type === 'income' ? '+' : '-'}{formatCurrency(transaction.amount)}\n                                            </td>\n                                            <td className=\"py-3 px-2 text-center\" style={{ width: '10%' }}>\n                                                <button\n                                                    onClick={() => handleDelete(transaction.id)}\n                                                    className=\"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors\"\n                                                    aria-label=\"Delete transaction\"\n                                                >\n                                                    <Trash2 className=\"w-4 h-4\" />\n                                                </button>\n                                            </td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n}\n
